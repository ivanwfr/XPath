<!DOCTYPE html>
<!-- ┌─────────────────────────────────────────────────────────────────────┐ -->
<!-- │ XPH [xpath.html]                                                    │ -->
<!-- └─────────────────────────────────────────────────────────────────────┘ -->
<html lang="fr">
<head>
  <title>xpath</title>
  <meta http-equiv="content-type" content="text/html" charset="utf-8">
<!-- STYLE link {{{-->
  <base href="./">
  <link href="./stylesheet/dom_host.css"  rel="stylesheet" type="text/css" />
  <link href="./stylesheet/div_tools.css" rel="stylesheet" type="text/css" />
<!--}}}-->
<!-- STYLE doc .. todo .. nodejs_dev_server_logs {{{-->
<!-- doc style {{{-->
  <style>
    details     { margin      : 0.3em 0.5em; }
    details     { white-space : initial; }
    details p   { margin-left : 2em; }
    details pre { margin-left : 2em; }
    summary     { cursor      : pointer; user-select: none; white-space: nowrap; }
    summary     { text-shadow : 1px 1px black; }

    summary>h2  { display: inline-block; }
    summary>h3  { display: inline-block; }

    summary>h2  { background-color: transparent; box-shadow: 2px 2px 2px rgba(136,136,136,0.5); }
    summary>h3  { background-color: #FFF;        box-shadow: 2px 2px 2px rgba(136,136,136,0.5); }

   @page { margin: 0.79in }

   BODY {
    margin        : 2em auto;
    width         : min-content;
    min-width     : 30em;
    border        : 1px dashed red;
    padding       : 1em;
    padding-bottom: 80%;
    background    : #CCC;
   }
   P {
    margin        : 0.5em auto;
    border-radius : 0.5em;
    border        : 2px groove white;
    background    : #DDD;
    padding       : 1em;
   }
   ul,
   pre {
    margin        : 0.5em auto;
    border-radius : 0.5em;
    border        : 1px inset white;
    background    : #CCC;
    padding       : 0.5em 2em;
   }
   ul { max-width: 70%; }
  .comment { background-color: rgba(136,255,136,0.8) !important; color: #222 !important; }
  .warning { background-color: rgba(255,136,136,0.5) !important; color: #222 !important; }
  </style>
<!--}}}-->
<!-- todo.css {{{-->
  <style>
  .todo {
   font-weight      : bolder;
   border           : double 4px white;
   background-color : #D00;
   color            : white;
   padding          : 0.1em 0.5em;
   line-height      : 2em;
  }
  .fixme {
   border           : double 4px red;
   background-color : #00D;
   color            : white;
   padding          : 0.1em 0.5em;
   line-height      : 2em;
  }

  details>details { margin-left: 2em !important; }
    #div_notes {
        display       : grid;
        width         : fit-content;
/*
        max-width     : 20%;
*/
        position      : fixed; top: 1em; left: 1em;
        border-radius : 0.2em;
        border-left   : solid 0.5em rgba(0,0,0,0.3);
        box-shadow    : 2px 2px 2px rgba(136,136,136,0.5);
        background    : linear-gradient(to bottom right, rgba(224,224,224,1.0), rgba(111,111,111,1.0));
        margin        : 0;
        max-height    : 90%;
        overflow      : auto;
        padding       : 0.5em;
    }

    #div_notes summary>button { pointer-events : none; }
    #div_notes>*              { margin-left    :    0; }
    .done {
/*
        text-decoration       : line-through;
        text-decoration-color : red;
*/
    }
    .done::before {
        position              : absolute; left: 70%;
        content               : "DONE";
        display               : inline-block;
        transform-origin      : 50% 50%;
        transform             : rotate(20deg) translate(-20%);
        padding               : 0 0.5em;
        color                 : rgba(000,136,000,0.7);
        text-shadow           : 1px 1px #888;
    }
    summary { background-color:   rgba(068,068,068,0.3); }
    summary { border-radius   :   0.5em; }
    summary { padding         : 0 0.5em; }

/*
  .p_input                  { display:inline-block; }
  .p_input.selected::before { content: "✔"; }
*/
  .p_input *                { pointer-events: none; } /* delegate to parent container */
  </style>
<!--}}}-->
<!-- nodejs_dev_server_logs style {{{-->
<style>

  .fg1 {            color : rgba(200,  99,   0, 1) !important; } /* overrides [ccX] color */
  .fg2 {            color : rgba(255,   0,   0, 1) !important; }
  .fg3 {            color : rgba(255, 165,   0, 1) !important; }
  .fg4 {            color : rgba(255, 255,   0, 1) !important; }
  .fg5 {            color : rgba(154, 205,  50, 1) !important; }
  .fg6 {            color : rgba(100, 149, 237, 1) !important; }
  .fg7 {            color : rgba(238, 130, 238, 1) !important; }
  .fg8 {            color : rgba(160, 160, 160, 1) !important; }
  .fg9 {            color : rgba(255, 255, 255, 1) !important; }
  .fg0 {            color : rgba(  0,   0,   0, 1) !important; text-shadow : 0px -1px #FFFFFF; }

  .nodejs_dev_server_logs {
  display                 : inline-block;
  width                   : 100%;
  }
  .nodejs_dev_server_logs * {
   background-color       : #111;
   color                  : #EEE;
   padding                : 0.1em 0.5em !important;
   margin                 : 0.5em !important;
   border-radius          : 1em;
  }
  .nodejs_dev_server_logs div {
   border                 : 2px inset;
   box-shadow             : 2px 2px 2px #888;
   padding                : 1em;
   overflow               : auto;
  }

</style>
<!--}}}-->
<!--}}}-->
<!-- SCRIPT scr {{{-->
  <script id="lib_log_js"               src="lib/lib_log.js"                ></script>
  <script id="lib_popup_js"             src="lib/lib_popup.js"              ></script>
  <script id="lib_util_js"              src="lib/lib_util.js"               ></script>
  <script id="config_js"                src="javascript/config.js"          ></script>
  <script id="outline_js"               src="javascript/outline.js"         ></script>
  <script id="div_tools_html_js"        src="javascript/div_tools_html.js"  ></script>
  <script id="xpath_js"                 src="javascript/xpath.js"           ></script>
  <script id="xpath_content_js"         src="javascript/xpath_content.js"   ></script>
<!--}}}-->
<!-- SCRIPT simulate_send_message {{{-->
 <script>
xpath_content_js.div_tools_init();
/*_ simulate_send_message {{{*/
let simulate_send_message = function(message_object,_caller)
{
let caller = "simulate_send_message";
let log_this = xpath_content_js.options.LOG3_SERVER;
if( log_this) lib_log.log_key_val_group(_caller+" ➔ "+caller+(message_object.cmd ? " "+message_object.cmd : ""),message_object, 9, true);

    let response = JSON.parse( JSON.stringify(message_object) ); /* DEEP COPY */

    switch(message_object.cmd)
    {
     case "domains" :
      response.domains
       =[ "goout.net"
       , "jslint.com"
       , "lemonde.fr"
       , "lefigaro.fr"
       , "remotetabs.com"
       , "wikipedia.org"
       ];

      xpath_content_js.get_domains_handler(response.domains);
      break;

     case "urls"    :
      response.parsed_response_err = "no error";
      response.parsed_items        = "URL x6";
      response.err                 = "no error";
      response.urls
       = [ "https://en.wikipedia.org/wiki/Data_mining"
       , "https://en.wikipedia.org/wiki/Patricia_Janečková"
       , "https://en.wikipedia.org/wiki/Richard_Smith-(English_guitarist)"
       , "https://en.wikipedia.org/wiki/Tommy_Emmanuel"
       , "https://wikipedia.org"
       , "https://www.wikipedia.org/"
       ];

      xpath_content_js.get_urls_handler   (response.urls);
      break;

     case "xpaths":
      response.parsed_response_err = "no error";
      response.err                 = "no error";
      response.parsed_items        = "XPATH x4";
      response.xpaths
       = [ "/html/body/h1"
//     ,   "/html/body/details/div/ul"
//     ,   "/html/body/details/div/p[4]"
//     ,   "/html/body/details[2]/summary/h2"
       ,   "/html/body/details[3]/div/details[2]/pre"
       ,   "/html/body/details[5]/ul/li/pre"
       ,   "/html/body/details[5]/ul/li[2]/pre"
       ,   "/html/body/details[5]/ul/li[3]/pre"
       ,   "/html/body/details[5]/ul[2]/li/pre"
       ];

      xpath_content_js.get_xpaths_handler (response.xpaths);
      break;

     case "add"     :
     case "delete"  :

      outline.add_or_delete_server_response_handler(response, message_object);
      break;

     default:
      lib_log.logBIG(caller+" unhandled cmd=["+message_object.cmd+"]");
    }
    /* SYNC GUI LAYOUT */
    div_tools_html_js.div_tools_layout_cmd( message_object.cmd );
};
/*}}}*/
 </script>
<!--}}}-->
</head>
<body onload='onload(event);'>

<!-- DOM_LOAD_TAG {{{-->
  <script>DOM_LOAD_ID="xpath"; DOM_LOAD_TAG=DOM_LOAD_ID+" (210909:15h:21)";
  let el = document.createElement("DIV");
  el.innerHTML="<pre style='position:fixed; top:0; right:0; font-size:24px; background-color:#D8D'>"+DOM_LOAD_TAG+"</pre>";
  document.body.insertBefore(el, document.body.firstElementChild);
  </script>

<!--}}}-->

<H1>Base de connaissance<br>et alimentation</H1>
<details id="introduction"><summary><H2>Introduction</H2></summary> <!--{{{-->
<div>
<P>L’alimentation
de la base de connaissance se fait site (nom de domaine) par site,
sur la base d’une url quelconque de celui-ci.</p>

<P>Elle se décline en 3 phases de:
</p>

<UL>
        <LI>collecte</li>
        <LI>clustering</li>
        <LI>labellisation
        (tâche manuelle)</li>
</UL>

<P>Les
phases de collecte et clustering sont séquentielles et automatiques,
elles font l’objet du job de collecte/clustering en NodeJS décrit.</p>
<P>L’extension
spécifiée ici permettra de labelliser les clusters, et d’extraire
certaines caractéristiques et alimenter la base de connaissance de
celles-ci.</p>

</div>
</details>
<!--}}}-->
<details id="modele"><summary><H2>Modèle de données</H2></summary> <!--{{{-->
<div>
<P STYLE="margin-bottom: 0in; line-height: 100%">Le modèle de
données décrit ici est la base de connaissance des sites internet.

    <details id="arbre"><summary><H3>Table ARBRE</H3></summary>
    <!--{{{-->
    <div>
    <P>Un échantillon d’url pour chacun des noms de domaine avec la
    structure décrivant l’arbre DOM stockée dans la colonne 
    tree_structure, sous la forme
    d’un fichier json. Voir paragraphe sur la modélisation de l’arbre
    DOM.
    <P>ARBRES(id,
    nomdomaine, url, tree_structure), id est un identifiant
    auto-incrémenté
    </div>
    <!--}}}-->
    </details>

    <details id="clustering_work"><summary><H3>Table CLUSTERING_WORK</H3></summary>
    <!--{{{-->
    <div>

    <P>C’est
    la table de travail pour la partie clustering. Voir la section sur le
    clustering pour les détails.
    <P>Brièvement,
    l’algorithme de clustering est joué pour différentes valeurs du
    paramètre cluster_nb (=Nc). Pour chaque valeur de l’hyperparamètre
    Nc, on affecte l’url à l’un des clusters.

    <P>CLUSTERING_WORK(tree_id, cluster_nb , cluster_id),
     avec:

     <UL>
      <LI>cluster_nb: c’est la valeur de l’hyper-paramètre de clustering, le nombre de clusters</LI>
      <LI>(tree_id, cluster_nb) est la clé primaire</LI>
      <LI>tree_id est une clé étrangère pointant vers ARBRES.id</LI>
      <LI>cluster_id: index (identifiant) du cluster auquel appartient l’url courante</LI>
     </UL>


    </div>
    <!--}}}-->
    </details>

    <details id="table_labellisation"><summary><H3>Table LABELLISATION _XPATH</H3></summary>
    <!--{{{-->
    <div>

    <P STYLE="margin-bottom: 0in; line-height: 100%">C’est la table
    remplie par l’opération de labellisation via l’extension. Voir
    la section Labellisation pour plus de détails.

    <P STYLE="margin-bottom: 0in; line-height: 100%">LABELLISATION_PATH(tree_id,
    xpathes, xpath_reduct) avec:
    <UL>
            <LI>tree_id: clé
            étrangère pointant vers la référence ARBRE.id
            <LI>xpathes:
            tableau JSON de chemins XPath, sous la forme d’un blob.
            <LI>xpath_reduct:
            formule réduite du XPath
    </UL>
    </div>
    <!--}}}-->
    </details>

</div>
</details>
<!--}}}-->
<details id="service"><summary><H2>Service de collecte/clustering</H2></summary> <!--{{{-->
<div>
    <!--{{{-->
    <div>
    <P>Présenté
    comme une API Rest, il est embarqué dans une application serveur
    NodeJS et appelé par un client http (appel serveur à serveur) et
    prend une url en paramètre. Il lance les deux phases de
    collecte-clustering en asynchrone, Le service lance la
    collecte/clustering en asynchrone et notifie immédiatement le client
    la bonne prise en compte.

    </div>
    <!--}}}-->
        <details id="dom"><summary><H3>Arbre DOM</H3></summary>
    <!--{{{-->
    <div>
    <P STYLE="margin-bottom: 0in; line-height: 100%">On représente
    l’arbre DOM/HTML du contenu de la page avec deux tableaux:
    <UL>
     <LI>la suite des tagname dans l’ordre croissant de leur index</LI>
     <LI>dans le même ordre, la liste des index fils pour chacun</LI>
    </UL>

    <P>C’est la
    modélisation la plus communément répandue dans les algorithmes
    basés sur la TED. On la représente comme suit (une structure JSON à
    deux tableaux)

<PRE>
{
   ‘tags’     : [ html, body, content, iframe, footer, note]
 , ‘children’ : [ [ 2,5], [3,4], [], [], [6], [] ]
}
    <img src="DOC/arbre.png" alt="DOC/arbre.png"/>
</PRE>

    <P>On note <I><B>structure</B></I>
    la fonction qui prend un contenu html et qui renvoie sa structure.

    <P>En base de données
    SQL, la structure sera stockée sous la forme d’un json dans un
    type de données blob (binary)

    </div>
    <!--}}}-->
    </details>

        <details id="collecte"><summary><H3>Collecte</H3></summary>
    <!--{{{-->
    <p>
    Le traitement prend
    en paramètre une url, on extrait le nom de domaine. L’objectif est
    d’alimenter la base de données de travail, la table ARBRE.
    </p>
    <pre>

    table SQL: ARBRES(id, nomdomaine, url, tree_structure)
    // id est un identifiant auto-incrémenté

    // version tail recursive:
    Définition:

    <B>collecte</B>(liste(url), tot=0):
                     si tot &gt;= max: return
                     urls           = []  // liste vide
                     Pour chaque url de liste(url):

    contenu        = getHTTPContent(url)

    tree_structure = structure (contenu)
                     ajoute entrée SQL  dans la table
                     ARBRES(id, nomdomaine, url, tree_structure)
                     // id: auto-incrémenté

    liens          = récupère toutes les urls (pointant vers le même nom de domaine)
                     depuis le contenu HTML
                     empile chacun des liens dans la liste urls

    collecte(urls, tot + sizeof(urls))
                         // tail recursive, permet l’optimisation de la pile
    </pre>
    <!--}}}-->
    </details>

        <details id="distances"><summary><H3>Calcul matrice des distances</H3></summary>
    <!--{{{-->
    <div>

    <P>Tree Edit Distance (TED): Elle permet de calculer la distance
    entre 2 arbres. C’est la longueur du plus court chemin pour passer
    d’un abre1 en un arbre2. Le chemin est la suite d’opérations
    d’insertion, suppression et modification du tagname de l’élément
    DOM.

    <P><A HREF="http://tree-edit-distance.dbresearch.uni-salzburg.at/">http://tree-edit-distance.dbresearch.uni-salzburg.at/</A>

    <P>L’objectif est de calculer une matrice de dimension n x n  où n
    est le nombre d’urls que l’on a analysé du nom de domaine. La
    matrice est stockée en mémoire. Elle prend en argument le nom du
    domaine et récupère l’ensemble des champs tree_structure de la
    base SQL. Elle calcule, deux à deux,  les distances TED (Tree Edit
    Distance) entre les structures d’arbre de chacun des 2. 



    <P>Note: Pour le clustering, il est absolument nécessaire d’avoir
    une distance (ou norme) au sens mathématiques du terme, notamment
    l’inégalité triangulaire.

    <A HREF="https://fr.wikipedia.org/wiki/Distance_(mathématiques)">https://fr.wikipedia.org/wiki/Distance_(mathématiques)</A>



    <P>Un package NodeJS satisfaisant à ces conditions de norme
    mathématiques:

    <A HREF="https://www.npmjs.com/package/edit-distance" title="implémentation npm de la tree edit distance">https://www.npmjs.com/package/edit-distance</A>
    <pre>

    Définition <b>matrice_distance(nomdomaine)</b>:

      liste(tree_structure) = récupération de toutes les lignes avec le nom de domaine

      mat = init matrice de dimension n * n avec n: taille (liste(tree_structure))

      Pour  idxI variant de      1 à len(tree_structure):
       Pour idxJ variant de idxI+1 à len(tree_structure):
        mat(idxI,idxJ) = TED(structure( idxI), structure( idxJ))

      mat = mat + transpose(mat)

      return mat
    </pre>

    </div>
    <!--}}}-->
    </details>

        <details id="clustering"><summary><H3>Clustering</H3></summary>
    <!--{{{-->
    <div>
    <P STYLE="margin-bottom: 0in; line-height: 100%">L’algorithme de
    clustering «&nbsp;s’entraîne&nbsp;» sur la matrice de distance.
    <P STYLE="margin-bottom: 0in; line-height: 100%">Son hyper-paramètre
    est le nombre de clusters Nc. Pour déterminer le meilleur
    hyper-paramètre Nc, on effectue le traitement pour les valeurs de Nc
    suivantes: de 1 à 10. Ce sont les résultats des métriques
    post-clustering qui détermineront le meilleur choix.

    <P>table
    SQL: CLUSTERING_WORK(tree_id, cluster_nb , cluster_id),
    <br> avec:
    <UL>
            <LI>cluster_nb: c’est la valeur de l’hyper-paramètre de clustering, le nombre de clusters
            <LI>(tree_id, cluster_nb) est la clé primaire
            <LI>tree_id est une clé étrangère pointant vers ARBRES.id
            <LI>cluster_id: index (identifiant) du cluster auquel appartient l’url courante
    </UL>

    <P>Utiliser
    l’algorithme des k plus proches voisins/ KNN.
    <A HREF="https://fr.wikipedia.org/wiki/Méthode_des_k_plus_proches_voisins">wikipedia knn</A>.

    </div>
    <!--}}}-->
    </details>

</div>
</details>
<!--}}}-->
<details id="labellisation"><summary><H2>Extension de labellisation</H2></summary> <!--{{{-->
<div>
    <!--{{{-->
    <div>

    <P>L’extension communique avec un serveur NodeJS connecté à la
    base PostgreSQL. L’extension récupère les urls devant être
    labellisés par l’extension, l’extension est redirigée
    séquentiellement sur chacune des urls, l’utilisateur effectue la
    labellisation (cliques sur éléments de contenu pertinent). Les
    chemins XPath sur chacun des éléments cliqués sont extraits et
    inscrits en base de données dans la table  LABELLISATION
    correspondant à l’url visitée.
    </div>
    <!--}}}-->
        <details id="xpath"><summary><H3>XPath dans le DOM</H3></summary>
    <!--{{{-->
    <div>

    <P>Chaque élément (ou tag) html peut être identifié par son
    chemin XPath. Nous prenons une forme simplifiée de sélecteur XPath:
    les «&nbsp;class&nbsp;» html et sélecteurs CSS ne sont pas pris en
    compte.

    <P>Exemple:
    <PRE>&lt;html&gt;
      &lt;head&gt;&lt;title&gt; Titre de la page&lt;/title&gt;&lt;/head&gt;
      &lt;body&gt;
              &lt;div&gt;&lt;h2&gt;Header&lt;/h2&gt;&lt;/div&gt;
              &lt;div&gt;&lt;h2&gt;Data&lt;/h2&gt;&lt;/div&gt;
              &lt;div&gt;&lt;h2&gt;Footer&lt;/h2&gt;&lt;/div&gt;
      &lt;/body&gt;
    &lt;/html&gt;</PRE><P>
    Le texte «&nbsp;Data&nbsp;» peut être localisé par son expression
    XPath: 


    </div>
    <!--}}}-->
    </details>
        <details id="calcul"><summary><H3>Calcul du XPath issu d’un clique</H3></summary>
    <!--{{{-->
    <div>

    <P>Lorsque l’utilisateur est redirigé sur la page qu’il doit
    labelliser, il doit ensuite cliquer sur quelques éléments texte
    pertinents et dans le corps de la page. Les chemins XPath des
    éléments cliqués sont ajoutés dans le tableau de la colonne
    xpathes de la table LABELLISATION_PATH.

    <P>Un menu contextuel permettant de valider ou de mettre de côté
    est continuellement affiché.

    <P>Note technique: je suppose que des gestionnaires d’évènements
    clique devront être ajoutés dynamiquement par l’extension sur
    tous les éléments de la page?

    <P>Précisions dans les captures d’écran.
    </div>
    <!--}}}-->
    </details>
        <details id="sampling"><summary><H3>Sampling des urls à labelliser</H3></summary>
    <!--{{{-->
    <div>

    <P>Pour un nom de domaine donné dont la collecte et le clustering
    ont été effectués, le traitement de sampling consiste à récupérer
    les urls des pages à labelliser.

    <P>Reste à faire (Amaël): détailler l’algorithme de sampling.
    </div>
    <!--}}}-->
    </details>
        <details id="réduction"><summary><H3>Réduction des XPathes d’une url</H3></summary>
    <!--{{{-->
    <div>

    <P>À l’issue de la la labellisation de l’url, on se retrouve
    avec un tableau de chemins XPath, notamment dans la colonne 
    LABELLISATION_PATH.xpathes

    <P>L’algorithme réduit ce tableau à un unique chemin XPath en
    prenant la racine commune aux différents pathes. Exemple:

    <P>On considère 3 chemins XPath pour la même url:
    <PRE>
    /html[0]/body[0]/div[1]/div[7]/h1[1]
    /html[0]/body[0]/div[1]/div[8]/div/a[0]
    /html[0]/body[0]/div[1]/div[9]/div[1]/h2[0] </PRE>

    <P>Alors le chemin parent commun à chacun est:
    <PRE>
    /html[0]/body[0]/div[1]
    </PRE>

    <P>C’est cette forme réduite qui est stockée dans la colonne
    LABELLISATION_PATH.xpath_reduct


    </div>
    <!--}}}-->
    </details>
</div>
</details>
<!--}}}-->

<!-- contrat_de_service -->
<hr>
<!--{{{-->

<details id="contrat_de_service"><summary><H2>contrat_de_service</H2></summary>

<p>
L'extension sollicite les 3 services du serveur NodeJS pour les points suivants:

<ul>
<li>- récupération des noms de domaine à récupérer:
<pre> <!--{{{-->
GET https://clustering.iwintoo.io/domains
- Params IN: aucun
- Params OUT: JSON/tableau des noms de domaine
ex: [ "https://www.lemonde.fr", "https://nomdomaine1", ... ]
</pre> <!--}}}-->
</li>


<li>- récupération des urls d'un nom de domaine:
<pre> <!--{{{-->
POST https://clustering.iwintoo.io/urls
- Params IN: nomdomaine: nom de domaine 1
- Params OUT: JSON/tableau des urls du nom de domaine:
ex: [ "https://www.lemonde.fr/gfhrz",  "https://www.lemonde.fr/mldsfsq",  ... ]
</pre> <!--}}}-->
</li>


<li>- transmission d'une liste de XPath liés à l'url:
<pre> <!--{{{-->
POST https://clustering.iwintoo.io/xpaths
- Params IN: JSON: { "url": "https://www.lemonde.fr/gfhrz", xpathes: [xpath1, xpath2]}
- Params OUT: aucun
</pre> <!--}}}-->
</li>

</ul>

<p>
Le job de collecte, pour un nom de domaine donnée est lancé par l'appel suivant:
<ul>
<li>
<pre>
POST https://clustering.iwintoo.io/collecte
- Params IN: JSON: { "domain": "https://www.lemonde.fr/gfhrz"}
- Params OUT: aucun
</pre>
</li>
</ul>

</details>
<!--}}}-->

<!-- nodejs_dev_server_logs -->
<hr>
<details class="nodejs_dev_server_logs"><summary><H2>nodejs_dev_server_logs</H2></summary> <!--{{{-->
<pre class="comment"> <!--{{{-->
Ces logs sont ceux du serveur NodeJS qui a servi à simuler
les dialogues XHR pendant le développement de l'extension.

Ils peuvent servir à véfifier la conformité des échanges spécifiés
entre le serveur et le background-script de l'extension.

En cas de besoin, il s'agira de faire converger la formulation
des requêtes et des réponses attendues...
</pre>
<!--}}}-->
<pre class="warning"> <!--{{{-->
ERROR REPLY:
 JSON-Object <em class="cc2"> { err: "error message" , ...query } </em>
</pre>
<!--}}}-->
<br>
<details class="nodejs_dev_server_logs"><summary><H3>/domains <em class="cc3"> FETCH PENDING DOMAINS ARRAY </em></H3></summary> <!--{{{-->
<div>

<H4>[domains] ➔ Expected reply</H4>
<pre class="comment">
 ➔ JSON-URL-Array <em class="cc5"> [] </em>
 ➔ let items = <em class="cc8"> JSON.parse( xhr.response ); </em>
</pre>

<H4>[domains] ➔ NodeJS SERVER LOGS</H4>

 <pre class="fg6">
 ┌──────────────────────────────────────────────────────────────────────────────┐
 │ request_listener: [domains]
 └──────────────────────────────────────────────────────────────────────────────┘
 REQUEST #11  {{{ uri.path=[domains]
 </pre>
 <pre class="fg7">
   ┌───────────────────────────────────────────────┐
 ➔ │ /domains method POST
   └───────────────────────────────────────────────┘
 </pre>
 <pre class="fg4">
   ┌─────────────────────────────────────────────────────────────────┐
   │ handle_request: request=[/domains]
   └─────────────────────────────────────────────────────────────────┘
 sql_query(response, qtext, uri=[/domains])
 qtext:
 [
 SELECT url FROM site_XPATH ORDER BY url
 ]
 </pre>
 <pre class="fg3">
 queries: ... length=[1]:
 [ 'SELECT url FROM site_XPATH ORDER BY url' ]
 </pre>
 <pre class="fg7">
   ┌────────────────────────────────────────────────────────────────────────────┐
 … │ POSTGRES  [1 / 1]:
 … │  SELECT url FROM site_XPATH ORDER BY url
   └────────────────────────────────────────────────────────────────────────────┘
 </pre>
 <pre class="fg6">
 sql_query: 1 pending_queries...
 ...responding with 123 res.rows:
 </pre>
 <pre class="fg7">
  ➔ lines_JSON:
    url : https://developer.mozilla.org
    url : https://en.m.wikipedia.org
    url : https://iwintoo.io
    url : https://lefigaro.fr
    url : https://lemonde.fr
 ...
 </pre>
 <pre class="fg6">
 REQUEST #11  }}} NO MORE pending_queries
 </pre>


</div>
</details>
<!--}}}-->
<br>
<details class="nodejs_dev_server_logs"><summary><H3>/urls {domain: url} <em class="cc3"> FETCH DOMAIN URL ARRAY </em></H3></summary> <!--{{{-->
<div>

<H4>[urls] ➔ Expected reply</H4>
<pre class="comment">
 ➔ JSON-URL-Array <em class="cc6"> [] </em>
 ➔ let items = <em class="cc8"> JSON.parse( xhr.response ); </em>
</pre>

<H4>[urls] ➔ NodeJS SERVER LOGS</H4>

 <pre class="fg6">
┌──────────────────────────────────────────────────────────────────────────────┐
│ request_listener: [urls]
└──────────────────────────────────────────────────────────────────────────────┘
REQUEST #12  {{{ uri.path=[urls]
 </pre>
 <pre class="fg7">
  ┌───────────────────────────────────────────────┐
➔ │ /urls method POST
  └───────────────────────────────────────────────┘
 </pre>
 <pre class="fg4">
  ┌─────────────────────────────────────────────────────────────────┐
  │ handle_request: request=[/urls]
➔ │ .      domain=[remotetabs.com]
  └─────────────────────────────────────────────────────────────────┘
sql_query(response, qtext, uri=[/urls])
qtext:
[
SELECT url FROM site_XPATH ,REGEXP_MATCHES(url, 'remotetabs.com' ) ORDER BY url
]
 </pre>
 <pre class="fg3">
queries: ... length=[1]:
[
  "SELECT url FROM site_XPATH ,REGEXP_MATCHES(url, 'remotetabs.com' ) ORDER BY url"
]
 </pre>
 <pre class="fg7">
  ┌────────────────────────────────────────────────────────────────────────────┐
… │ POSTGRES  [1 / 1]:
… │  SELECT url FROM site_XPATH
… │  , REGEXP_MATCHES(url
… │  , 'remotetabs.com'
… │  ) ORDER BY url
  └────────────────────────────────────────────────────────────────────────────┘
 </pre>
 <pre class="fg6">
sql_query: 1 pending_queries...
 </pre>
 <pre class="fg5">
...responding with 23 res.rows:
 </pre>
 <pre class="fg7">
 ➔ lines_JSON:
   url : https://remotetabs.com/
   url : https://remotetabs.com/dev/
   url : https://remotetabs.com/dev/iwintoo/
...
 </pre>
 <pre class="fg6">
REQUEST #12  }}} NO MORE pending_queries
 </pre>

</div>
</details>
<!--}}}-->
<br>
<details class="nodejs_dev_server_logs"><summary><H3>/xpaths (no cmd) <em class="cc3"> FETCH PAGE XPATH ARRAY </em></H3></summary> <!--{{{-->
<div>

<H4>[xpaths] ➔ Expected reply</H4>
<pre class="comment">
 ➔ JSON-XPATH-Array <em class="cc6"> [] </em>
 ➔ let items = <em class="cc8"> JSON.parse( xhr.response ); </em>
</pre>

<H4>[xpaths] ➔ NodeJS SERVER LOGS</H4>

 <pre class="fg6">
┌──────────────────────────────────────────────────────────────────────────────┐
│ request_listener: [xpaths]
└──────────────────────────────────────────────────────────────────────────────┘
REQUEST #13  {{{ uri.path=[xpaths]
 </pre>
 <pre class="fg7">
  ┌───────────────────────────────────────────────┐
➔ │ /xpaths method POST
  └───────────────────────────────────────────────┘
 </pre>
 <pre class="fg4">
  ┌─────────────────────────────────────────────────────────────────┐
  │ handle_request: request=[/xpaths]
  │ .         cmd=[xpaths]
➔ │ .         url=[https://remotetabs.com/]
  └─────────────────────────────────────────────────────────────────┘
sql_query(response, qtext, uri=[/xpaths])
qtext:
[
SELECT xpath FROM site_XPATH WHERE url = $$https://remotetabs.com/$$;
]
 </pre>
 <pre class="fg3">
queries: ... length=[2]:
[
  'SELECT xpath FROM site_XPATH WHERE url = $$https://remotetabs.com/$$',
  ''
]
 </pre>
 <pre class="fg7">
  ┌────────────────────────────────────────────────────────────────────────────┐
… │ POSTGRES  [1 / 1]:
… │  SELECT xpath FROM site_XPATH
… │  WHERE url = $$https://remotetabs.com/$$
  └────────────────────────────────────────────────────────────────────────────┘
 </pre>
 <pre class="fg6">
sql_query: 1 pending_queries...
 </pre>
 <pre class="fg5">
...responding with 3 res.rows:
 </pre>
 <pre class="fg7">
 ➔ lines_JSON:
   xpath : /html/body/div 4 /section/div 2 /a
   xpath : /html/body/div 4 /section/p 3
   xpath : /html/body/div 4 /section/p 6 /span 2 /a 3
 </pre>
 <pre class="fg6">
REQUEST #13  }}} NO MORE pending_queries
 </pre>

</div>
</details>
<!--}}}-->
<br>
<details class="nodejs_dev_server_logs"><summary><H3>/xpaths {cmd: delete} <em class="cc3"> DELETE PAGE SINGLE XPATH </em> </H3></summary> <!--{{{-->
<div>

<H4>[xpath] ➔ Expected reply</H4>
<pre class="comment">
 [ANY ACK-REPLY JSON-Object] <em class="cc2">{...} </em>
</pre>

<H4>[xpath] ➔ NodeJS SERVER LOGS</H4>
 <pre class="fg6">
┌──────────────────────────────────────────────────────────────────────────────┐
│ request_listener: [xpaths]
└──────────────────────────────────────────────────────────────────────────────┘
REQUEST #48  {{{ uri.path=[xpaths]
 </pre>
 <pre class="fg7">
  ┌───────────────────────────────────────────────┐
➔ │ /xpaths method POST
  └───────────────────────────────────────────────┘
 </pre>
 <pre class="fg4">

  ┌─────────────────────────────────────────────────────────────────┐
  │ handle_request: request=[/xpaths]
  │ .         cmd=[delete]
➔ │ .         url=[https://remotetabs.com/]
  │ .       xpath=[/html/body/div[4]/section/p[6]/span[2]/a[3]]
  │ .        text=[https://groups.google.com/forum/?hl=en#!forum/remotetabs]
  └─────────────────────────────────────────────────────────────────┘
sql_query(response, qtext, uri=[/xpaths])
qtext:
[
DELETE       FROM site_XPATH WHERE url = $$https://remotetabs.com/$$ AND xpath=$$/html/body/div[4]/section/p[6]/span[2]/a[3]$$;
]
 </pre>
 <pre class="fg3">

queries: ... length=[2]:
[
  'DELETE       FROM site_XPATH WHERE url = $$https://remotetabs.com/$$ AND xpath=$$/html/body/div[4]/section/p[6]/span[2]/a[3]$$',
  ''
]
 </pre>
 <pre class="fg7">

  ┌────────────────────────────────────────────────────────────────────────────┐
… │ POSTGRES  [1 / 1]:
… │  DELETE       FROM site_XPATH
… │  WHERE url = $$https://remotetabs.com/$$
… │  AND xpath=$$/html/body/div[4]/section/p[6]/span[2]/a[3]$$
  └────────────────────────────────────────────────────────────────────────────┘
 </pre>
 <pre class="fg6">
sql_query: 1 pending_queries...
 </pre>
 <pre class="fg4">

 ➔ answer:
   err : NO SQL REPLY TO REQUEST
   query : DELETE       FROM site_XPATH WHERE url = $$https://remotetabs.com/$$ AND xpath=$$/html/body/div 4 /section/p 6 /span 2 /a 3 $$
   uri : /xpaths
...
 </pre>
 <pre class="fg6">
REQUEST #48  }}} NO MORE pending_queries
 </pre>
</div>
</details>
<!--}}}-->
<br>
<details class="nodejs_dev_server_logs"><summary><H3>/xpaths {cmd: add} <em class="cc3"> REPLACE PAGE SINGLE XPATH </em> </H3></summary> <!--{{{-->
<div>

<H4>[xpath] ➔ Expected reply</H4>
<pre class="comment">
 [ANY ACK-REPLY JSON-Object] <em class="cc2">{...} </em>
</pre>

<H4>[xpath] ➔ NodeJS SERVER LOGS</H4>

 <pre class="fg6">
┌──────────────────────────────────────────────────────────────────────────────┐
│ request_listener: [xpaths]
└──────────────────────────────────────────────────────────────────────────────┘
REQUEST #61  {{{ uri.path=[xpaths]
 </pre>
 <pre class="fg7">
  ┌───────────────────────────────────────────────┐
➔ │ /xpaths method POST
  └───────────────────────────────────────────────┘
 </pre>
 <pre class="fg4">

  ┌─────────────────────────────────────────────────────────────────┐
  │ handle_request: request=[/xpaths]
  │ .         cmd=[add]
➔ │ .         url=[https://remotetabs.com/]
  │ .       xpath=[/html/body/div[4]/section/p[6]]
  │ .        text=[...your input is quite welcome on the following sites:]
  └─────────────────────────────────────────────────────────────────┘
sql_query(response, qtext, uri=[/xpaths])
qtext:
[
DELETE       FROM site_XPATH WHERE url = $$https://remotetabs.com/$$ AND xpath=$$/html/body/div[4]/section/p[6]$$;
INSERT INTO site_XPATH values($$https://remotetabs.com/$$, $$/html/body/div[4]/section/p[6]$$, $$...your input is quite welcome on the following sites:$$);
]
 </pre>
 <pre class="fg3">

queries: ... length=[3]:
[
  'DELETE       FROM site_XPATH WHERE url = $$https://remotetabs.com/$$ AND xpath=$$/html/body/div[4]/section/p[6]$$',
  'INSERT INTO site_XPATH values($$https://remotetabs.com/$$, $$/html/body/div[4]/section/p[6]$$, $$...your input is quite welcome on the following sites:$$)',
  ''
]
 </pre>
 <pre class="fg7">

  ┌────────────────────────────────────────────────────────────────────────────┐
… │ POSTGRES  [1 / 1]:
… │  DELETE       FROM site_XPATH
… │  WHERE url = $$https://remotetabs.com/$$
… │  AND xpath=$$/html/body/div[4]/section/p[6]$$
  └────────────────────────────────────────────────────────────────────────────┘
  ┌────────────────────────────────────────────────────────────────────────────┐
… │ POSTGRES  [2 / 2]:
… │  INSERT INTO site_XPATH
… │  values($$https://remotetabs.com/$$
… │  , $$/html/body/div[4]/section/p[6]$$
… │  , $$...your input is quite welcome on the following sites:$$
… │  )
  └────────────────────────────────────────────────────────────────────────────┘
 </pre>
 <pre class="fg6">
sql_query: 2 pending_queries...
 </pre>
 <pre class="fg4">
 ➔ answer:
   err : NO SQL REPLY TO REQUEST
   query : DELETE       FROM site_XPATH WHERE url = $$https://remotetabs.com/$$ AND xpath=$$/html/body/div 4 /section/p 6 $$
   uri : /xpaths
...
 </pre>
 <pre class="fg6">
REQUEST #61  }}} NO MORE pending_queries
 </pre>

</div>
</details>
<!--}}}-->
</details><!--}}}-->

<!-- TODO -->
<!--{{{-->

<div id="div_notes">

 <span
 class   = "p_input"
 title   = "
A l'ouverture d'une section
les autres seront
automatiquement refermées
"
 onclick = 'details_radio_toggle(event);'
 >
 <input type="checkbox" id="details_radio"/>
 <label>details radio</label>
 </span>

 <details id="todo">
 <summary>TODO</summary>

 <hr>
 <details>  <summary><em class='todo'> 9. GUI </em></summary>
<pre> <!-- todo {{{-->

<em class="fixme"> FIXME </em> :  Compatibilité <em class='cc1'>Chrome</em>  <em class='cc2'>Opera</em> et <em class='cc3'>Firefox</em>
...Valider la compatibilité pour les autres <em class='cc4'>navigateurs à supporter</em>.

<em class="todo"> TODO </em> : <em class="cc1"> Valider l'IHM </em> avec les <em class="cc2"> utilisateurs </em>

<em class="todo"> TODO </em> : <em class="cc1"> Documenter </em> les outils de l'interface en fonction des remarques

</pre> <!--}}}-->
  <details> <summary><em class="cc0"> DONE </em> : </summary>
<!-- DONE PRE {{{-->
<pre>

<em class="fixme"> FIXME </em> : Repérer les <em class="cc1"> DOMAINS </em> et <em class="cc2"> URLS </em> déjà <em class="cc3"> VISITÉS </em>
 ➔ repérer les <em class="cc4">DOMAINS</em> sans <em class="cc5">URL</em>
 ➔ repérer les <em class="cc6">URLS</em> sans <em class="cc7">XPATH</em>
 … <em class="cc5">(attribut JSON alimenté par les requêtes SQL ?)</em>

<em class="cc0"> DONE </em> : ??? ... à creuser <em class="cc1"> minimal GUI </em> quand positionné <em class="cc2"> à gauche de la page </em>

<em class="cc0"> DONE </em> : <em class="cc1"> confine to VIEWPORT </em> on <em class="cc2"> RESIZE </em> and <em class="cc3"> ORIENTATION </em>

<em class="cc0"> DONE </em> : <em class="cc1"> enchainements après add to location domain</em> on a new domain ➔ REFRESH CALL TO <em class="cc2"> get_domains </em> <em class="cc3"> get_urls </em>

<em class="cc0"> DONE </em> : creuser encore un peu l'ergonomie des <em class="cc1"> enchainements </em>:
         ➔ <em class="cc1"> SELECT </em>
          &#x21B3; <em class="cc2"> ADJUST </em>
           &#x21B3; <em class="cc3"> ADD    </em>
            &#x21B3; <em class="cc4"> DELETE </em>

<em class="cc0"> DONE </em> : <em class='cc1'> del_wheel_listener </em> ➔ <em class='cc2'> on_touch_device </em>
    ➔ <em class='cc3'> quick touchmove </em> <em class='cc4'> wheel emulation </em>
    handled like a canceling click on <em class='cc5'> div_mask </em>

<em class="cc0"> DONE </em> : add a <em class="cc1"> FRAME </em> to just created <em class="cc2"> [+] </em> <em class="cc3"> single selection </em>

<em class="cc0"> DONE </em> : <em class="cc1"> LONG URLS </em> .. par exemple: <em class="cc2"> page-produit amazon </em>

<em class="cc0"> DONE </em> : synchronisation <em class="cc1"> ADD OR DELETE [button_sample] </em>
    <em class="cc2"> &#x2573; &#x2573; &#x2573; </em> ➔ <em class="cc3"> &#x2795; &#x2795; &#x2795; </em>
    quand des sélections peuvent être <em class='cc2'> supprimées </em> ou <em class='cc3'> ajoutées </em>

<em class="cc0"> DONE (EMBEDDED ONLY ???) </em> :
    A click on <em class="cc1"> [✔] </em> of <em class="cc2"> div_xpaths>DIV.confirm </em>
    should not call <em class="cc4"> send_xpath_cmd: add </em>

<em class="cc0"> DONE </em> : <em class="cc1"> page highlight </em> ➔ premier affichage d'une <em class="cc2"> page déjà visitée </em>

<em class="cc0"> DONE </em> : <em class="cc1"> confine to VIEWPORT </em> on <em class="cc2"> LOAD </em>

<em class="cc0"> not so good idea </em> : <em class="cc1"> div_options hidden </em> ➔ remove "hidden"
    on reload when some <em class="cc2"> LOG OPTION </em> is selected

<em class="cc0"> DONE </em> : <em class="cc1"> ADJUST XPATH </em> … <em class="cc2"> div_xpaths_click_handler </em>
         Cocher <em class="cc3"> #div_xpaths>DIV.selected>EM:nth-of-type(2) </em>
         pour désigner le point à cliquer
         pour confirmer le choix du parent

<em class="cc0"> DONE </em> : <em class="cc1"> div_tools_onMove </em> ➔ solve the <em class='cc2'> mouse-out issue </em>

<em class="cc0"> DONE </em> : <em class="cc1"> ON UNLOAD </em> ➔ remove framed targets<em class="cc2"> LOG OPTION </em> is selected
</pre>
<!--}}}-->
<!--{{{-->
 <pre>
  <em class="cc1"> LOG1_STEP </em> ➔ tracer les transitions principale dans la console

  <em class="cc1"> Montée en charge ➔ overflow auto </em> <em class="cc2"> domains </em> <em class="cc3"> urls </em> <em class="cc4"> xpaths </em>
   SOLUTION:
   ➔ scrollbar
   ➔ transition
   ➔ touch-device-handler
   ➔ drag vs. scroll handling

 </pre>
<!--}}}-->
  </details>
 </details>

<hr>

<details>
  <summary><em class='todo'> 8. FIELD-TESTS ➔ CLIENT-SERVER DATA FORMAT: </em></summary>
  <pre>
    <em class='cc1'> /domains </em>
    <em class='cc2'> /urls domain </em>
    <em class='cc3'> /xpaths url </em>
    <em class='cc4'> /xpaths add </em>
    <em class='cc5'> /xpaths delete </em>
  </pre>
</details>

 <hr>
 <details class="done">
  <summary><em class='todo'> 7. FIELD-TESTS ➔ STATE-TRANSITION: </em></summary>
  <pre>
    ➔ TABLES PostgreSQL
    &#x21B3; SERVER NodeJS
    &#x21B3; XMLHttpRequest extension <em> BACKGROUND SCRIPT </em>
    &#x21B3; <em> runtime.sendMessage </em> form <em> BACKGROUND SCRIPT </em> ➔ <em> CONTENT SCRIPT </em>
    &#x21B3; <em> OUTLINING </em> labelled page
    &#x21B3; <em> ADJUSTING </em> parent-child selection
    &#x21B3; <em> REPORTING </em> outlines HTMLElement
    &#x21B3; <em> RELOADING </em> stored XPaths of <em> ALREADY VISITED </em> pages
  </pre>
 </details>

 <details class="done">
  <summary><em class='fg6'> 6. ...<em class='fg3'> SERVER NodeJS </em> .. (modifier USR/server.js) </em></summary>
  <pre>
    ┌──────────────────────────────────────────┐
    │ XPH XMLHttpRequest <em class='cc3'> RESPONSE </em> <em class='cc6'> SQL </em> <em class='cc5'> POSTGRES </em>
    └──────────────────────────────────────────┘
  </pre>
 </details>

 <details class="done">
  <summary><em class='cc5'> 5. ...<em class='cc0'> CLIENT </em> XMLHttpRequest </em></summary>
  <pre>
  ...done
  </pre>
 </details>

 <details class="done">
  <summary><em class='cc4'> 4. ...<em class='cc2'> VERSION EXTENSION CHROME </em> </em></summary>
  <pre>
     ...manifest.json
  </pre>
 </details>

 <details class="done">
  <summary><em class='cc3'> 3. XPath: </em></summary>
  <pre>
    dom_util.get_nodeXPath($0);
    "4 DETAILS of BODY|2 DIV of DETAILS|2 DETAILS of DIV|1 SUMMARY of DETAILS|1 H3 of SUMMARY"
    @see: /LOCAL/STORE/DEV/PROJECTS/RTabs/Util/RTabs_Profiles/DEV/javascript/dom_util.js
  </pre>
 </details>

 <details class="done">
  <summary><em class='cc2'> 2. TOGGLE-BUTTON: </em></summary>
  <pre>
     To capture [mouse-click events]
     and stop propagation to the
     visited page handlers
  </pre>
 </details>

 <details class="done">
  <summary><em class='cc1'> 1. ONLOAD: </em></summary>
  <pre>
     [SAVE / LOAD] from localStorage
     pour les [details:open]
  </pre>
 </details>

 </details>
</div>
<!--}}}-->

<!-- script - details_ontoggle {{{-->
<!--{{{
<body onload='onload(event);'>
}}}-->
 <span
 class   = "p_input"
 title   = "
A l'ouverture d'une section
les autres seront
automatiquement refermées
"
 onclick = 'details_radio_toggle(event);'
 >
 <input type="checkbox" id="details_radio"/>
 <label>details radio</label>
 </span>

 <script>
 /*_ details_ontoggle {{{*/
 let details_ontoggle = function(event)
 {
//console.dir(event)
     let details = event.target;
     if(!details     ) return;

//console.log("➔ details=["+details+"]")
     if(details.id) {
         if(details.open) lib_util.localStorage_setItem(details.id+"_open", "true");
         else             lib_util.localStorage_delItem(details.id+"_open"        );
     }

     if(!details.open) return;

     let details_radio  = lib_util.localStorage_getItem("details_radio");
//console.log("➔ details_radio=["+details_radio+"]")
     if(!details_radio ) return;

     let parent = details.parentElement;
     for(let i=0; i<parent.children.length; ++i)
     {
         // skip target
         let siblings = parent.children[i];
         if(siblings == event.target) continue;

         // close siblings
         if(siblings.tagName == "DETAILS")
         {
             siblings.open = false;
             if(siblings.id)
                 lib_util.localStorage_delItem(siblings.id+"_open");
         }
     }
 };
 /*}}}*/
/*_ details_radio {{{*/
let details_radio_toggle = function(e)
{
console.log("details_radio_toggle("+e.target.tagName+")")

   /* input */
   let    id = "details_radio";
   let input = (e.target.tagName == "INPUT")
    ?           e.target
    :           lib_util.get_tool(id);
//console.log("➔ input=["+input.tagName+"]")

    /* toggle */
    if(e.target != input) input.checked = !input.checked;

    /* UI */
//  if(input.checked) input.parentElement.classList.add   ("selected");
//  else              input.parentElement.classList.remove("selected");
//  let container = document .getElementById("todo"   );
    let container = document.documentElement;
    let details   = container.querySelectorAll("DETAILS");
    Array.from(details).forEach( (el) => { el.open = false; });

   /* store */
   if( input.checked   ) lib_util.localStorage_setItem(id, "true");
   else                  lib_util.localStorage_delItem(id        );
};

let details_radio_set_from_localStorage = function()
{
//console.log("details_radio_set_from_localStorage")

   let id = "details_radio";
   let el =                          lib_util.get_tool(id        );
   if( el ) el.checked = lib_util.localStorage_getItem(id        );
};

/*}}}*/
/*_ onload {{{*/
//console.log("onload:")
let onload = function()
{
//console.log("onload") // Note: No localStorage for file:// protocol

 details_radio_set_from_localStorage();

 let details = document.querySelectorAll("DETAILS");
//console.dir(details)

 Array.from(details).forEach( (el) => { el.addEventListener("toggle", details_ontoggle); });

 Array.from(details).forEach( (el) => {
     let open = el.id && lib_util.localStorage_getItem(el.id+"_open");
     if( open ) {
//console.log(el.id+" open")
        el.open = true;
     }
 });

};

/*}}}*/
 </script>
<!--}}}-->

</body>
</html>

<!-- {{{
}!!ls %:h/stylesheet/*
}!!ls %:h/javascript/*
..

..

}}}-->
<!--{{{
vim sw=4
:!start explorer "file:///C:/LOCAL/DATA/ANDROID/PROJECTS/iwintoo/XPH/xpath.html"
:!start explorer         "C:\LOCAL\DATA\ANDROID\PROJECTS\iwintoo\XPH\"
:e XPH/manifest.json
:new                  $WPROJECTS/RTabs/Util/RTabs_Profiles/DEV/javascript/dom_load.js
}}}-->

